{% extends "base.html" %}

{% block title %}Dashboard - Copy Trading System{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">
            <i class="fas fa-dashboard me-2"></i>Dashboard
        </h1>
    </div>
</div>

<!-- Statistics Cards -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card bg-primary">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="card-title text-white">Master Accounts</h5>
                        <h2 class="text-white mb-0">{{ master_accounts }}</h2>
                    </div>
                    <i class="fas fa-user-crown fa-2x text-white opacity-75"></i>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card bg-success">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="card-title text-white">Follower Accounts</h5>
                        <h2 class="text-white mb-0">{{ follower_accounts }}</h2>
                    </div>
                    <i class="fas fa-users fa-2x text-white opacity-75"></i>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card bg-info">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="card-title text-white">Trades Today</h5>
                        <h2 class="text-white mb-0">{{ recent_trades }}</h2>
                    </div>
                    <i class="fas fa-chart-line fa-2x text-white opacity-75"></i>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card bg-warning">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="card-title text-dark">Copied Trades</h5>
                        <h2 class="text-dark mb-0">{{ recent_copied }}</h2>
                    </div>
                    <i class="fas fa-copy fa-2x text-dark opacity-75"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Trades -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-clock me-2"></i>Recent Trades
                </h5>
            </div>
            <div class="card-body">
                {% if latest_trades %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Symbol</th>
                                    <th>Side</th>
                                    <th>Type</th>
                                    <th>Quantity</th>
                                    <th>Price</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for trade in latest_trades %}
                                <tr>
                                    <td>{{ trade.created_at.strftime('%H:%M:%S') }}</td>
                                    <td>
                                        <span class="badge bg-secondary">{{ trade.symbol }}</span>
                                    </td>
                                    <td>
                                        <span class="badge {% if trade.side == 'Buy' %}bg-success{% else %}bg-danger{% endif %}">
                                            {{ trade.side }}
                                        </span>
                                    </td>
                                    <td>{{ trade.order_type }}</td>
                                    <td>{{ "%.4f"|format(trade.quantity) }}</td>
                                    <td>
                                        {% if trade.price %}
                                            ${{ "%.2f"|format(trade.price) }}
                                        {% else %}
                                            Market
                                        {% endif %}
                                    </td>
                                    <td>
                                        <span class="badge 
                                            {% if trade.status == 'executed' %}bg-success
                                            {% elif trade.status == 'pending' %}bg-warning
                                            {% elif trade.status == 'failed' %}bg-danger
                                            {% else %}bg-secondary{% endif %}">
                                            {{ trade.status.title() }}
                                        </span>
                                    </td>
                                    <td>
                                        <a href="{{ url_for('trade_detail', trade_id=trade.id) }}" 
                                           class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-chart-line fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">No trades yet</h5>
                        <p class="text-muted">Trades will appear here when the system starts copying.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- System Status -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-heartbeat me-2"></i>System Status
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Trade Copier Service</h6>
                        <div class="d-flex align-items-center">
                            <span id="copier-status" class="badge bg-secondary me-2">Loading...</span>
                            <small id="copier-description" class="text-muted">Checking service status...</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6>API Connections</h6>
                        <div class="d-flex align-items-center">
                            <span id="api-status" class="badge bg-secondary me-2">Loading...</span>
                            <small id="api-description" class="text-muted">Checking API connections...</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Auto-refresh dashboard every 30 seconds
setInterval(function() {
    location.reload();
}, 30000);
</script>
{% endblock %}
